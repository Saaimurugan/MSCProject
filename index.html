<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Application</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 { color: #333; text-align: center; margin-bottom: 30px; }
        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 10px;
            margin-bottom: 20px;
        }
        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        .question-counter {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
        }
        .question-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        .question-box h3 { color: #333; margin-bottom: 10px; }
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        textarea:focus { outline: none; border-color: #667eea; }
        .btn {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            display: block;
            margin: 20px auto 0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102,126,234,0.4); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .loading { display: none; text-align: center; padding: 20px; }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .btn-secondary {
            background: linear-gradient(90deg, #11998e, #38ef7d);
        }
        .btn-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; }
            .btn { display: none !important; }
            .result-card { break-inside: avoid; page-break-inside: avoid; }
        }
</style>
</head>
<body>
    <div class="container">
        <h1>üìù Quiz Application</h1>
        
        <div id="quiz-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <div class="question-counter" id="question-counter">Question 1 of 5</div>
            
            <div class="question-box">
                <h3 id="question-text"></h3>
            </div>
            
            <textarea id="user-answer" placeholder="Type your answer here..."></textarea>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Evaluating your answer...</p>
            </div>
            
            <button class="btn" id="submit-btn" onclick="submitAnswer()">Submit Answer</button>
        </div>
        
        <div id="scorecard-section" style="display: none;"></div>
    </div>

    <script>
        // Questions and example answers stored in frontend
        const questionsData = [
            {
                question: "What is Machine Learning?",
                example_answer: "Machine learning is a subset of artificial intelligence that enables systems to learn and improve from experience without being explicitly programmed. It focuses on developing algorithms that can access data and use it to learn for themselves."
            },
            {
                question: "Explain the concept of Object-Oriented Programming (OOP).",
                example_answer: "Object-Oriented Programming is a programming paradigm based on the concept of objects, which contain data and code. The four main principles are encapsulation, abstraction, inheritance, and polymorphism. It helps organize code into reusable, modular components."
            },
            {
                question: "What is the difference between SQL and NoSQL databases?",
                example_answer: "SQL databases are relational, use structured query language, and have predefined schemas. NoSQL databases are non-relational, can store unstructured data, and offer flexible schemas. SQL is better for complex queries while NoSQL excels at scalability and handling large volumes of diverse data."
            },
            {
                question: "What is an API and why is it important?",
                example_answer: "An API (Application Programming Interface) is a set of protocols and tools that allows different software applications to communicate with each other. It defines methods and data formats for requesting and exchanging information, enabling integration between systems and services."
            },
            {
                question: "Explain the concept of Cloud Computing.",
                example_answer: "Cloud computing is the delivery of computing services including servers, storage, databases, networking, and software over the internet. It offers faster innovation, flexible resources, and economies of scale. Users can access resources on-demand without managing physical infrastructure."
            }
        ];

        let currentQuestionIndex = 0;
        let scores = [];

        function init() {
            displayQuestion();
        }

        function displayQuestion() {
            const question = questionsData[currentQuestionIndex];
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('user-answer').value = '';
            document.getElementById('question-counter').textContent = 
                `Question ${currentQuestionIndex + 1} of ${questionsData.length}`;
            document.getElementById('progress-fill').style.width = 
                `${(currentQuestionIndex / questionsData.length) * 100}%`;
        }

        async function submitAnswer() {
            const userAnswer = document.getElementById('user-answer').value.trim();
            if (!userAnswer) {
                alert('Please provide an answer before submitting.');
                return;
            }

            const submitBtn = document.getElementById('submit-btn');
            const loading = document.getElementById('loading');
            
            submitBtn.disabled = true;
            loading.style.display = 'block';

            try {
                const response = await fetch('/score', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_answer: userAnswer,
                        example_answer: questionsData[currentQuestionIndex].example_answer
                    })
                });

                const result = await response.json();
                let scoreData;
                
                if (result.body) {
                    const jsonMatch = result.body.match(/```json\n([\s\S]*?)\n```/);
                    scoreData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(result.body);
                } else {
                    scoreData = result;
                }

                scores.push({
                    question: questionsData[currentQuestionIndex].question,
                    userAnswer: userAnswer,
                    score: parseInt(scoreData.score) || 0,
                    evaluation: scoreData.evaluation || '',
                    suggestions: scoreData.suggestions || ''
                });

                currentQuestionIndex++;

                if (currentQuestionIndex < questionsData.length) {
                    displayQuestion();
                } else {
                    showScorecard();
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error scoring answer. Please try again.');
            } finally {
                submitBtn.disabled = false;
                loading.style.display = 'none';
            }
        }

        function showScorecard() {
            document.getElementById('quiz-section').style.display = 'none';
            const scorecardSection = document.getElementById('scorecard-section');
            scorecardSection.style.display = 'block';

            const totalScore = scores.reduce((sum, s) => sum + s.score, 0);
            const avgScore = (totalScore / scores.length).toFixed(1);
            const maxPossible = scores.length * 10;

            let html = `
                <h2 style="text-align:center; color:#333; margin-bottom:30px;">üéâ Quiz Completed!</h2>
                <div style="display:flex; justify-content:space-around; margin-bottom:30px; flex-wrap:wrap; gap:15px;">
                    <div style="background:linear-gradient(135deg,#667eea,#764ba2); color:white; padding:20px 30px; border-radius:15px; text-align:center; min-width:150px;">
                        <div style="font-size:32px; font-weight:bold;">${totalScore}/${maxPossible}</div>
                        <div>Total Score</div>
                    </div>
                    <div style="background:linear-gradient(135deg,#11998e,#38ef7d); color:white; padding:20px 30px; border-radius:15px; text-align:center; min-width:150px;">
                        <div style="font-size:32px; font-weight:bold;">${avgScore}/10</div>
                        <div>Average Score</div>
                    </div>
                </div>
                <h3 style="color:#333; margin-bottom:15px;">Detailed Results:</h3>
            `;

            scores.forEach((s, i) => {
                const scoreColor = s.score >= 7 ? '#38ef7d' : s.score >= 5 ? '#f39c12' : '#e74c3c';
                html += `
                    <div class="result-card" style="background:#f8f9fa; padding:20px; border-radius:10px; margin-bottom:15px; border-left:4px solid ${scoreColor};">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <strong>Q${i+1}: ${s.question}</strong>
                            <span style="background:${scoreColor}; color:white; padding:5px 15px; border-radius:20px; font-weight:bold;">${s.score}/10</span>
                        </div>
                        <p style="color:#666; font-size:14px; margin-bottom:8px;"><strong>Your Answer:</strong> ${s.userAnswer}</p>
                        <p style="color:#555; font-size:14px; margin-bottom:8px;"><strong>Evaluation:</strong> ${s.evaluation}</p>
                        ${s.suggestions ? `<p style="color:#667eea; font-size:14px;"><strong>Suggestions:</strong> ${s.suggestions}</p>` : ''}
                    </div>
                `;
            });

            html += `
                <div class="btn-group">
                    <button class="btn" onclick="restartQuiz()">Restart Quiz</button>
                    <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Print Results</button>
                </div>
            `;
            scorecardSection.innerHTML = html;
        }

        function restartQuiz() {
            currentQuestionIndex = 0;
            scores = [];
            document.getElementById('quiz-section').style.display = 'block';
            document.getElementById('scorecard-section').style.display = 'none';
            displayQuestion();
        }

        init();
    </script>
</body>
</html>
